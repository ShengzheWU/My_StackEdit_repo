## 浅析Charge IC中的NVDC架构

> 由于PSC2945的浪涌失效问题困扰了我很久，因此对此类Charge IC的NVDC架构进行了一些研究。

### NVDC 拓扑结构

目前见到的NVDC拓扑都包含4颗MOS管，如下图所示
![NVDC架构](https://github.com/ShengzheWU/PhotoBed/blob/main/NVDC.png?raw=true)
其中Q1是输入FET，用于防止电压倒灌；Q2、Q3构成一个BUCK电路，分别是高侧FET和低侧FET；Q4是电池充电控制FET，通过控制Q4的通断来控电池的充电速度。

### 分析不同工作状态下，各个MOS是如何工作的

通常NVDC的Charge IC工作状态（使用场景）有三种：电池供电、适配器供电、适配器充电&供电。

#### 电池供电

当整个系统没有适配器输入的时候，Charge由电池供电驱动，此时Q1、Q2、Q3均关断，但是由于Q2的体二极管，Vbat电压会泄露到PMID（拓扑结构中没有标注出来，在PSC2945上PMID为Q1与Q2连接的结点）。因此Q1管的体二极管必须朝向PMID的方向，否则Vbat的电压就会倒灌到VBUS，造成无适配器/USB供电情况下，系统中VBUS出现一个电压。

>值得一提的是，PSC2945正是因为Q1被击穿，才造成了无适配器情况下出现软件误判正在充电的情形。其原因就在于Vbat电压倒灌到Vbus中，让Soc误以为有Vbus输入，所以显示正在充电。

#### 适配器供电

当系统插入适配器而没有电池的时候，系统由适配器供电驱动。此时Q1导通，Q2、Q3工作在BUCK模式下，将输入的VBUS或高于5V的电压，降低到寄存器确认的Vsys电压值


#### 适配器充电&供电

此时情况类似适配器供电，同样的Q1导通，Q2、Q3工作在BUCK模式，Q4也工作在BUCK模式给电池充电。

### 分析浪涌失效时，为何Q1会被击穿

结合上面讲述的NVDC拓扑与MOS工作状态可以知道，Q1管在正常工作的时候Vsd会是一个非常低的电压，因为无论Q1是否导通，它的体二极管会将Vsd钳位到1V以内。因此在设计Q1的时候，就不会考虑将Q1设计成Vds耐高压的FET，**而是将Q1设计成一个低压FET**。这就为浪涌失效埋下了伏笔。由于Q1的体二极管朝向PMID，将Q1两端压降钳位到1V以内，所以Vbus的高压会全部加在Q2上，如果Q2一旦被击穿，Vbus上的高压会直接涌入到Vsys上损坏后面的电路。这是IC设计者不愿意看到的情况。**因此Q2被设计为一个高压FET**。

了解了Q1和Q2的状况，就可以分析浪涌失效时发生了什么。当适配器插入，Charge IC检测到VBUS有符合条件的电压接入，于是便开始了正常工作，Q1打开，Q2、Q3工作在BUCK模式。此时突然打入一个浪涌，在TVS的作用下，浪涌残压被限制在15V左右，这个残压将触发Charge IC的OVP，Q1、Q2、Q3立马关断。大量的电荷通过Q1的体二极管用于PMID，但由于Q2关断又无法释放，这样就造成PMID即Q1的漏极上累积大量电荷。此时Q1的源极由于外部电阻漏电（Vbus分压采集电路等）Q1的源极电荷迅速损失，即Vs电压快速下降，而在短时间内Vd仍保持一个较高电压的状态，此时**Vsd的压差超过Q1的设计耐压**，就导致Q1被击穿。

因此PSC的FAE建议在PMID与Vbus之间添加一颗4.5V的TVS用来保护钳位Vsd，防止过压击穿Q1，出现Vbat反灌Vbus的情况。
